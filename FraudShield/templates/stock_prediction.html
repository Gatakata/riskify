{% extends "base.html" %}

{% block title %}Stock Prediction Results{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <!-- Header -->
            <div class="text-center mb-4">
                <i class="fas fa-chart-line fa-3x text-success mb-3"></i>
                <h2 class="text-success">Stock Prediction Results</h2>
                <p class="text-muted">Analysis completed using Random Forest algorithm</p>
            </div>

            <!-- Main Prediction Card -->
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="fas fa-chart-area me-2"></i>Price Direction Prediction</h5>
                </div>
                <div class="card-body text-center">
                    <div class="row">
                        <div class="col-md-6">
                            <h3 class="display-6 {% if prediction.predicted_direction == 'UP' %}text-success{% else %}text-danger{% endif %}">
                                {% if prediction.predicted_direction == 'UP' %}
                                    <i class="fas fa-arrow-up me-2"></i>{{ prediction.predicted_direction }}
                                {% else %}
                                    <i class="fas fa-arrow-down me-2"></i>{{ prediction.predicted_direction }}
                                {% endif %}
                            </h3>
                            <p class="text-muted">Predicted Direction</p>
                        </div>
                        <div class="col-md-6">
                            <h3 class="display-6 text-primary">{{ (prediction.confidence * 100)|round(1) }}%</h3>
                            <p class="text-muted">Confidence Level</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Detailed Analysis -->
            <div class="row g-4 mb-4">
                <!-- Probabilities -->
                <div class="col-md-6">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-header bg-light">
                            <h6 class="mb-0"><i class="fas fa-percentage me-2"></i>Probability Analysis</h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span class="text-success">Up Probability</span>
                                    <span>{{ (prediction.up_probability * 100)|round(1) }}%</span>
                                </div>
                                <div class="progress">
                                    <div class="progress-bar bg-success" style="width: {{ prediction.up_probability * 100 }}%"></div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span class="text-danger">Down Probability</span>
                                    <span>{{ (prediction.down_probability * 100)|round(1) }}%</span>
                                </div>
                                <div class="progress">
                                    <div class="progress-bar bg-danger" style="width: {{ prediction.down_probability * 100 }}%"></div>
                                </div>
                            </div>
                            <div class="text-center mt-3">
                                <span class="badge {% if prediction.expected_return >= 0 %}bg-success{% else %}bg-danger{% endif %} fs-6">
                                    Expected Return: {{ (prediction.expected_return * 100)|round(2) }}%
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Risk Assessment -->
                <div class="col-md-6">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-header bg-light">
                            <h6 class="mb-0"><i class="fas fa-exclamation-triangle me-2"></i>Risk Assessment</h6>
                        </div>
                        <div class="card-body">
                            <div class="text-center mb-3">
                                {% set risk_color = 'success' if prediction.risk_level == 'LOW' else 'warning' if prediction.risk_level == 'MEDIUM' else 'danger' %}
                                <span class="badge bg-{{ risk_color }} fs-5">{{ prediction.risk_level }} RISK</span>
                            </div>
                            <p><strong>Model Used:</strong> {{ prediction.model_used }}</p>
                            <p><strong>Analysis Date:</strong> Current Analysis</p>
                            
                            <h6 class="mt-3">Market Signals:</h6>
                            <ul class="list-unstyled small">
                                {% for signal in prediction.market_signals %}
                                <li><i class="fas fa-signal me-2 text-muted"></i>{{ signal }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Input Summary -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-light">
                    <h6 class="mb-0"><i class="fas fa-info-circle me-2"></i>Analysis Input</h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>Current Price:</strong> ${{ "%.2f"|format(stock_data.current_price) }}</p>
                            <p><strong>Volume:</strong> {{ "{:,}".format(stock_data.volume) }}</p>
                            <p><strong>RSI:</strong> {{ stock_data.rsi }}</p>
                            <p><strong>MACD:</strong> {{ stock_data.macd }}</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>20-Day MA:</strong> ${{ "%.2f"|format(stock_data.moving_avg_20) }}</p>
                            <p><strong>50-Day MA:</strong> ${{ "%.2f"|format(stock_data.moving_avg_50) }}</p>
                            <p><strong>Volatility:</strong> {{ (stock_data.volatility * 100)|round(1) }}%</p>
                            <p><strong>1-Day Change:</strong> {{ stock_data.price_change_1d }}%</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="row">
                <div class="col-md-4">
                    <a href="{{ url_for('stock_prediction') }}" class="btn btn-success w-100">
                        <i class="fas fa-redo me-2"></i>Analyze Another Stock
                    </a>
                </div>
                <div class="col-md-4">
                    <a href="{{ url_for('download_stock_report') }}" class="btn btn-warning w-100">
                        <i class="fas fa-download me-2"></i>Download Report
                    </a>
                </div>
                <div class="col-md-4">
                    <a href="{{ url_for('index') }}" class="btn btn-outline-secondary w-100">
                        <i class="fas fa-home me-2"></i>Back to Hub
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}