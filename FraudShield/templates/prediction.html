{% extends "base.html" %}

{% block title %}Analysis Result - FraudGuard{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8 mx-auto">
        <!-- Header -->
        <div class="text-center mb-4">
            <h1 class="display-6 fw-bold text-primary mb-3">Transaction Analysis Result</h1>
        </div>

        <!-- Result Card -->
        <div class="card shadow border-0 mb-4">
            <div class="card-header {% if result.is_fraud %}bg-danger{% else %}bg-success{% endif %} text-white">
                <h5 class="card-title mb-0 d-flex align-items-center">
                    <i class="fas {% if result.is_fraud %}fa-exclamation-triangle{% else %}fa-check-circle{% endif %} me-2"></i>
                    {% if result.is_fraud %}FRAUD DETECTED{% else %}TRANSACTION SAFE{% endif %}
                </h5>
            </div>
            <div class="card-body p-4">
                <div class="row">
                    <div class="col-md-6">
                        <!-- Risk Level -->
                        <div class="mb-3">
                            <h6 class="fw-bold text-muted mb-2">Risk Assessment</h6>
                            <div class="d-flex align-items-center">
                                <div class="risk-indicator {% if result.is_fraud %}risk-high{% else %}risk-low{% endif %} me-3"></div>
                                <span class="fs-5 fw-bold {% if result.is_fraud %}text-danger{% else %}text-success{% endif %}">
                                    {% if result.is_fraud %}HIGH RISK{% else %}LOW RISK{% endif %}
                                </span>
                            </div>
                        </div>

                        <!-- Fraud Probability -->
                        <div class="mb-3">
                            <h6 class="fw-bold text-muted mb-2">Fraud Probability</h6>
                            <div class="progress mb-2" style="height: 25px;">
                                <div class="progress-bar {% if result.fraud_probability > 0.7 %}bg-danger{% elif result.fraud_probability > 0.3 %}bg-warning{% else %}bg-success{% endif %}" 
                                     role="progressbar" 
                                     style="width: {{ (result.fraud_probability * 100)|round(1) }}%">
                                    {{ (result.fraud_probability * 100)|round(1) }}%
                                </div>
                            </div>
                        </div>

                        <!-- Confidence Score -->
                        <div class="mb-3">
                            <h6 class="fw-bold text-muted mb-2">Confidence</h6>
                            <div class="progress mb-2" style="height: 25px;">
                                <div class="progress-bar bg-info" 
                                     role="progressbar" 
                                     style="width: {{ (result.confidence * 100)|round(1) }}%">
                                    {{ (result.confidence * 100)|round(1) }}%
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <!-- Model Information -->
                        <div class="mb-3">
                            <h6 class="fw-bold text-muted mb-2">Analysis Model</h6>
                            <span class="badge bg-primary fs-6">
                                {% if result.model_used == 'xgboost' %}
                                    XGBoost ML Model
                                {% else %}
                                    Rule-Based Engine
                                {% endif %}
                            </span>
                        </div>

                        <!-- Recommendation -->
                        <div class="mb-3">
                            <h6 class="fw-bold text-muted mb-2">Recommendation</h6>
                            {% if result.is_fraud %}
                                <div class="alert alert-danger mb-0">
                                    <i class="fas fa-ban me-2"></i>
                                    <strong>DECLINE TRANSACTION</strong><br>
                                    <small>High fraud risk detected. Additional verification required.</small>
                                </div>
                            {% else %}
                                <div class="alert alert-success mb-0">
                                    <i class="fas fa-check me-2"></i>
                                    <strong>APPROVE TRANSACTION</strong><br>
                                    <small>Transaction appears legitimate and safe to process.</small>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transaction Summary -->
        <div class="card shadow-sm border-0 mb-4">
            <div class="card-header bg-light">
                <h6 class="card-title mb-0">
                    <i class="fas fa-receipt me-2"></i>
                    Transaction Summary
                </h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <dl class="row">
                            <dt class="col-sm-6">Amount:</dt>
                            <dd class="col-sm-6">${{ "%.2f"|format(transaction_data.transaction_amount) }}</dd>
                            
                            <dt class="col-sm-6">Merchant:</dt>
                            <dd class="col-sm-6">{{ transaction_data.merchant_category|title }}</dd>
                            
                            <dt class="col-sm-6">Time:</dt>
                            <dd class="col-sm-6">{{ transaction_data.transaction_hour }}:00</dd>
                            
                            <dt class="col-sm-6">Day:</dt>
                            <dd class="col-sm-6">
                                {% set days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'] %}
                                {{ days[transaction_data.transaction_day - 1] }}
                            </dd>
                            
                            <dt class="col-sm-6">Customer Age:</dt>
                            <dd class="col-sm-6">{{ transaction_data.customer_age }} years</dd>
                            
                            <dt class="col-sm-6">Account Age:</dt>
                            <dd class="col-sm-6">{{ transaction_data.account_age_days }} days</dd>
                        </dl>
                    </div>
                    <div class="col-md-6">
                        <dl class="row">
                            <dt class="col-sm-6">Failed Attempts:</dt>
                            <dd class="col-sm-6">{{ transaction_data.previous_failed_attempts }}</dd>
                            
                            <dt class="col-sm-6">Merchant Risk:</dt>
                            <dd class="col-sm-6">{{ (transaction_data.merchant_risk_score * 100)|round(1) }}%</dd>
                            
                            <dt class="col-sm-6">24h Frequency:</dt>
                            <dd class="col-sm-6">{{ transaction_data.transaction_frequency_24h }}</dd>
                            
                            <dt class="col-sm-6">30d Average:</dt>
                            <dd class="col-sm-6">${{ "%.2f"|format(transaction_data.avg_transaction_amount_30d) }}</dd>
                            
                            <dt class="col-sm-6">Location Risk:</dt>
                            <dd class="col-sm-6">{{ (transaction_data.location_risk_score * 100)|round(1) }}%</dd>
                            
                            <dt class="col-sm-6">Device Risk:</dt>
                            <dd class="col-sm-6">{{ (transaction_data.device_risk_score * 100)|round(1) }}%</dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="text-center">
            <a href="{{ url_for('fraud_detection') }}" class="btn btn-primary btn-lg me-3">
                <i class="fas fa-plus me-2"></i>
                Analyze Another
            </a>
            <a href="{{ url_for('download_fraud_report') }}" class="btn btn-success btn-lg me-3">
                <i class="fas fa-download me-2"></i>
                Download Report
            </a>
            <a href="{{ url_for('index') }}" class="btn btn-outline-secondary btn-lg">
                <i class="fas fa-home me-2"></i>
                Back to Hub
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Add some visual effects for the result display
document.addEventListener('DOMContentLoaded', function() {
    // Animate progress bars
    const progressBars = document.querySelectorAll('.progress-bar');
    progressBars.forEach(bar => {
        const width = bar.style.width;
        bar.style.width = '0%';
        setTimeout(() => {
            bar.style.transition = 'width 1s ease-in-out';
            bar.style.width = width;
        }, 300);
    });
    
    // Add pulse effect to risk indicator
    const riskIndicator = document.querySelector('.risk-indicator');
    if (riskIndicator && riskIndicator.classList.contains('risk-high')) {
        setInterval(() => {
            riskIndicator.style.boxShadow = '0 0 20px rgba(220, 53, 69, 0.8)';
            setTimeout(() => {
                riskIndicator.style.boxShadow = '0 0 10px rgba(220, 53, 69, 0.4)';
            }, 500);
        }, 1000);
    }
});
</script>
{% endblock %}
